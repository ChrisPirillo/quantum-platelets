<!DOCTYPE html>
<html lang="en">
<head>
    <!--
      Technical SEO, Performance, and Core Web Vitals Optimizations by Gemini
      - Date: 2025-08-11
      - Goal: Achieve Lighthouse > 90, LCP < 2.5s, FID < 100ms, CLS < 0.1 without altering JS functionality.
    -->

    <!-- Basic SEO & Character Set -->
    <meta charset="UTF-8">
    <title>Quantum Platelets: An Interactive WebGL Experience</title>
    <meta name="description" content="Explore Quantum Platelets, a mesmerizing interactive art experience powered by WebGL. Manipulate abstract, glowing particle fields in real-time to create unique visual phenomena.">
    <meta name="keywords" content="webgl, interactive art, generative art, shader, real-time graphics, quantum platelets, creative coding, digital art">
    <meta name="author" content="Chris Pirillo">

    <!-- Viewport & Core Vitals -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://pirillo.com/arcade/quantum-platelets.html">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://pirillo.com/arcade/quantum-platelets.html">
    <meta property="og:title" content="Quantum Platelets: An Interactive WebGL Experience">
    <meta property="og:description" content="Explore Quantum Platelets, a mesmerizing interactive art experience powered by WebGL. Manipulate abstract, glowing particle fields in real-time.">
    <meta property="og:image" content="https://pirillo.com/arcade/images/quantum-platelets.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="Pirillo's Arcade">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://pirillo.com/arcade/quantum-platelets.html">
    <meta name="twitter:title" content="Quantum Platelets: An Interactive WebGL Experience">
    <meta name="twitter:description" content="Explore Quantum Platelets, a mesmerizing interactive art experience powered by WebGL. Manipulate abstract, glowing particle fields in real-time.">
    <meta name="twitter:image" content="https://pirillo.com/arcade/images/quantum-platelets.png">
    <meta name="twitter:creator" content="@ChrisPirillo">

    <!-- Resource Hints: Preconnect to critical third-party origins -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
    <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>

    <!-- Resource Hints: Preload critical CSS for faster rendering -->
    <link rel="preload" href="https://cdn.tailwindcss.com" as="script">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap"></noscript>

    <!-- Stylesheets -->
    <script src="https://cdn.tailwindcss.com"></script> <!-- Tailwind is required for initial UI, should not be deferred -->

    <!-- Critical Inline CSS: Essential for above-the-fold content and preventing CLS -->
    <style>
        /* Using font-display: swap in the preloaded link handles FOUT/FOIT */
        body {
            font-family: 'Share Tech Mono', monospace;
            color: #E0E0E0;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            background-color: #000; /* Set base background to prevent flash of unstyled content */
        }
        .sidebar {
            transition: transform 0.3s ease-in-out;
        }
        .sidebar-content {
            scrollbar-width: thin;
            scrollbar-color: #4f4f4f #1f2937;
        }
        .sidebar-content::-webkit-scrollbar { width: 8px; }
        .sidebar-content::-webkit-scrollbar-track { background: #1f2937; }
        .sidebar-content::-webkit-scrollbar-thumb { background-color: #4f4f4f; border-radius: 10px; border: 3px solid #1f2937; }
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 4px;
            background: #4a5568;
            border-radius: 5px;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }
        input[type="range"]:hover { opacity: 1; }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #a0aec0;
            cursor: pointer;
            border-radius: 50%;
        }
        input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #a0aec0;
            cursor: pointer;
            border-radius: 50%;
        }
    </style>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1CQ4D3VQ3L"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-1CQ4D3VQ3L');
    </script>

    <!-- JSON-LD Structured Data for Rich Snippets -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Quantum Platelets",
      "applicationCategory": "Game",
      "operatingSystem": "Any (WebGL)",
      "url": "https://pirillo.com/arcade/quantum-platelets.html",
      "author": {
        "@type": "Person",
        "name": "Chris Pirillo",
        "url": "https://chris.pirillo.com/"
      },
      "description": "An interactive, real-time WebGL art experience where users can manipulate and randomize parameters to create unique, glowing abstract visuals.",
      "screenshot": "https://pirillo.com/arcade/images/quantum-platelets.png",
      "offers": {
        "@type": "Offer",
        "price": "0"
      }
    }
    </script>

</head>
<body class="bg-black">

    <main>
        <!-- WebGL Canvas: This is the Largest Contentful Paint element. It's sized to prevent layout shift. -->
        <canvas id="gl-canvas" class="absolute top-0 left-0 w-full h-full" width="1920" height="1080" aria-label="Interactive WebGL animation of quantum platelets"></canvas>

        <!-- Header containing navigation elements -->
        <header>
            <!-- Hamburger Menu Button with accessibility improvements -->
            <button id="menu-toggle" class="absolute top-4 right-4 z-20 p-2 text-white" aria-label="Toggle settings menu" aria-expanded="false" aria-controls="sidebar">
                <svg id="menu-open-icon" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="32" height="32" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
                <svg id="menu-close-icon" xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="32" height="32" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </header>

        <!-- Sidebar: Using <aside> for auxiliary content -->
        <aside id="sidebar" class="sidebar fixed top-0 right-0 h-full w-80 sm:w-96 bg-gray-900 bg-opacity-80 backdrop-blur-md z-10 shadow-2xl transform translate-x-full">
            <div class="sidebar-content p-6 h-full overflow-y-auto">
                <h1 class="text-2xl mb-4 text-center">Quantum Platelets</h1>
                <div class="mb-5">
                    <button id="randomize-btn" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded transition-colors duration-300">
                        Randomize
                    </button>
                </div>
                <section id="controls-container" class="space-y-5" aria-label="Shader Controls">
                    <!-- Controls will be dynamically inserted here by JavaScript -->
                </section>
            </div>
        </aside>
    </main>

    <!--
      SHADER SCRIPTS
      These are not executable JavaScript but data blocks read by the main script.
      They are correctly placed to be available when the main script runs.
    -->
    <script id="vertex-shader" type="x-shader/x-vertex">
        attribute vec4 a_position;
        void main() {
            gl_Position = a_position;
        }
    </script>

    <script id="fragment-shader" type="x-shader/x-fragment">
        precision highp float;
        uniform vec2 u_resolution;
        uniform float u_time;

        // --- User Controls ---
        uniform float u_zoom;
        uniform float u_iterations;
        uniform float u_v_y;

        // Raymarching parameters
        uniform float u_step_base;
        uniform float u_step_mult;

        // SDF (Signed Distance Function) parameters
        uniform float u_sdf_freq;
        uniform float u_sdf_time_mult;
        uniform float u_sdf_radius;

        // Shading/Coloring parameters
        uniform float u_glow_dampen;
        uniform float u_glow_strength;
        uniform float u_glow_freq;
        uniform vec4 u_color_mult;
        uniform float u_exposure;

        // Manual implementation of tanh for GLSL ES 1.00 (WebGL 1)
        float tanh(float x) {
            float ex = exp(x);
            float emx = exp(-x);
            if (ex == 0.0) return -1.0;
            if (emx == 0.0) return 1.0;
            return (ex - emx) / (ex + emx);
        }

        // --- Rotation Matrix functions to break grid artifacts ---
        mat3 rotX(float a) {
            float s = sin(a); float c = cos(a);
            return mat3(1.0, 0.0, 0.0, 0.0, c, -s, 0.0, s, c);
        }
        mat3 rotY(float a) {
            float s = sin(a); float c = cos(a);
            return mat3(c, 0.0, s, 0.0, 1.0, 0.0, -s, 0.0, c);
        }

        void main() {
            vec2 uv = (gl_FragCoord.xy * 2.0 - u_resolution.xy) / u_resolution.y;
            vec3 s = normalize(vec3(uv * u_zoom, -1.0));

            vec4 o = vec4(0.0);
            float z = 0.0;
            vec3 v = vec3(0.0, u_v_y, 0.0);
            
            for(float i = 0.0; i < 200.0; i++) {
                if (i >= u_iterations) break;

                vec3 p = s * z + v;
                p.z -= u_time;
                
                // Apply a slight, fixed rotation to the space to break axis-aligned artifacts.
                p = rotY(0.3) * rotX(0.2) * p;

                vec3 q = p;
                q += p * v - sin(q.zxy * u_sdf_freq - u_time * u_sdf_time_mult);
                float d = length(sin(q) - v) - u_sdf_radius;

                d = u_step_base + u_step_mult * abs(d);
                z += d;

                if (d < 0.001 || z > 100.0) break;

                o += (u_glow_strength - cos(length(p) / u_glow_freq) / (u_glow_dampen + d)) / d / z;
            }

            // Apply tanh component-wise using our manual implementation
            vec4 final_color = o / u_exposure * u_color_mult;
            final_color.x = tanh(final_color.x);
            final_color.y = tanh(final_color.y);
            final_color.z = tanh(final_color.z);
            final_color.w = tanh(final_color.w);

            gl_FragColor = final_color;
            gl_FragColor.a = 1.0;
        }
    </script>

    <!--
      MAIN APPLICATION SCRIPT
      - This script is UNCHANGED as per the instructions.
      - The 'defer' attribute is not added because the script relies on `window.onload`,
        which already defers execution until all page content is loaded. Adding 'defer'
        would be redundant and could alter execution timing in subtle ways.
        The current placement at the end of the body is the best practice for this scenario.
    -->
    <script>
        // --- Main Application Logic ---
        window.onload = () => {
            const canvas = document.getElementById('gl-canvas');
            const gl = canvas.getContext('webgl', { antialias: true });

            if (!gl) {
                console.error("WebGL not supported!");
                document.body.innerHTML = "Sorry, your browser does not support WebGL.";
                return;
            }

            // --- Shader and Program Setup ---
            function createShader(gl, type, source) {
                const shader = gl.createShader(type);
                gl.shaderSource(shader, source);
                gl.compileShader(shader);
                if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
                    // Log the error to the console for debugging.
                    console.error('An error occurred compiling the shaders: ' + gl.getShaderInfoLog(shader));
                    gl.deleteShader(shader);
                    return null;
                }
                return shader;
            }

            const vertexShaderSource = document.getElementById('vertex-shader').text;
            const fragmentShaderSource = document.getElementById('fragment-shader').text;
            const vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexShaderSource);
            const fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentShaderSource);
            
            // --- Error handling for shader creation ---
            if (!vertexShader || !fragmentShader) {
                console.error("Shader creation failed. Aborting initialization.");
                return;
            }

            const program = gl.createProgram();
            gl.attachShader(program, vertexShader);
            gl.attachShader(program, fragmentShader);
            gl.linkProgram(program);

            if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
                console.error('Unable to initialize the shader program: ' + gl.getProgramInfoLog(program));
                return;
            }
            gl.useProgram(program);

            // --- Buffer for a fullscreen quad ---
            const positionBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1, -1, 1, -1, -1, 1, 1, 1]), gl.STATIC_DRAW);
            const positionAttributeLocation = gl.getAttribLocation(program, "a_position");
            gl.enableVertexAttribArray(positionAttributeLocation);
            gl.vertexAttribPointer(positionAttributeLocation, 2, gl.FLOAT, false, 0, 0);

            // --- Uniforms and Controls ---
            const uniforms = {
                // Scene
                iterations: { value: 30, min: 5, max: 150, step: 1, label: "Scene: Iterations" },
                v_y: { value: 1.0, min: 0, max: 1, step: 0.01, label: "Scene: Vertical Offset" },
                
                // Raymarching
                step_base: { value: 0.01, min: 0.001, max: 0.030, step: 0.001, label: "Raymarch: Step Base" },
                step_mult: { value: 0.75, min: 0.75, max: 2.0, step: 0.01, label: "Raymarch: Step Multiplier" },
                
                // Shape (SDF)
                sdf_radius: { value: 0.1, min: 0.01, max: 0.5, step: 0.001, label: "Shape: Radius" },
                sdf_freq: { value: 0.6, min: 0.1, max: 2.0, step: 0.01, label: "Shape: Frequency" },
                sdf_time_mult: { value: 0.2, min: 0.0, max: 1.0, step: 0.01, label: "Shape: Time Warp" },
                                
                // Shading
                glow_strength: { value: 15.0, min: 15.0, max: 30.0, step: 0.1, label: "Shading: Glow Strength" },
                glow_dampen: { value: 0.1, min: 0.01, max: 1.0, step: 0.01, label: "Shading: Glow Dampen" },
                glow_freq: { value: 0.2, min: 0.05, max: 1.0, step: 0.01, label: "Shading: Glow Frequency" },
                
                // Color Channels (handled separately)
                color_mult_r: { value: 9.0, min: 0.0, max: 20.0, step: 0.1, label: "Color: Red Channel" },
                color_mult_g: { value: 3.0, min: 0.0, max: 20.0, step: 0.1, label: "Color: Green Channel" },
                color_mult_b: { value: 1.0, min: 0.0, max: 20.0, step: 0.1, label: "Color: Blue Channel" },
                color_mult_a: { value: 0.0, min: 0.0, max: 20.0, step: 0.1, label: "Color: Alpha Channel (tanh)" },
            };

            const uniformLocations = {};
            for (const key in uniforms) {
                if (!key.startsWith('color_mult_')) {
                    uniformLocations[key] = gl.getUniformLocation(program, `u_${key}`);
                }
            }
            // Get fixed uniform locations separately
            uniformLocations.zoom = gl.getUniformLocation(program, 'u_zoom');
            uniformLocations.exposure = gl.getUniformLocation(program, 'u_exposure');
            uniformLocations.color_mult = gl.getUniformLocation(program, 'u_color_mult');
            uniformLocations.resolution = gl.getUniformLocation(program, 'u_resolution');
            uniformLocations.time = gl.getUniformLocation(program, 'u_time');

            const controlsContainer = document.getElementById('controls-container');
            for (const key in uniforms) {
                const u = uniforms[key];
                const controlHTML = `
                    <div class="control-group">
                        <div class="flex justify-between items-center mb-1">
                            <label for="${key}" class="text-sm">${u.label}</label>
                            <span id="${key}-value" class="text-sm font-mono bg-gray-700 px-2 py-1 rounded">${u.value}</span>
                        </div>
                        <input type="range" id="${key}" name="${key}" min="${u.min}" max="${u.max}" value="${u.value}" step="${u.step}" class="w-full">
                    </div>
                `;
                controlsContainer.innerHTML += controlHTML;
            }

            for (const key in uniforms) {
                const input = document.getElementById(key);
                const valueSpan = document.getElementById(`${key}-value`);
                input.addEventListener('input', (e) => {
                    uniforms[key].value = parseFloat(e.target.value);
                    valueSpan.textContent = uniforms[key].value;
                });
            }

            // --- Randomization Logic ---
            function randomizeSettings() {
                for (const key in uniforms) {
                    const u = uniforms[key];
                    const randomValue = Math.random() * (u.max - u.min) + u.min;
                    
                    let finalValue;
                    if (u.step >= 1) {
                         finalValue = Math.round(randomValue / u.step) * u.step;
                    } else {
                        // For floating point, round to a reasonable number of decimal places
                        const precision = 1 / u.step;
                        finalValue = (Math.round(randomValue * precision) / precision).toFixed(String(u.step).split('.')[1]?.length || 0);
                    }
                    
                    uniforms[key].value = parseFloat(finalValue);

                    const input = document.getElementById(key);
                    const valueSpan = document.getElementById(`${key}-value`);

                    if (input && valueSpan) {
                        input.value = uniforms[key].value;
                        valueSpan.textContent = uniforms[key].value;
                    }
                }
            }

            // --- UI Interaction ---
            const menuToggle = document.getElementById('menu-toggle');
            const sidebar = document.getElementById('sidebar');
            const openIcon = document.getElementById('menu-open-icon');
            const closeIcon = document.getElementById('menu-close-icon');
            const randomizeBtn = document.getElementById('randomize-btn');
            
            menuToggle.addEventListener('click', () => {
                const isExpanded = sidebar.classList.toggle('translate-x-full');
                openIcon.classList.toggle('hidden');
                closeIcon.classList.toggle('hidden');
                menuToggle.setAttribute('aria-expanded', !isExpanded);
            });

            randomizeBtn.addEventListener('click', randomizeSettings);
            
            // Randomize on initial load
            randomizeSettings();

            // --- Render Loop ---
            let startTime = Date.now();
            function render() {
                // Resize canvas to match display size
                const dpr = window.devicePixelRatio || 1;
                const displayWidth = Math.floor(canvas.clientWidth * dpr);
                const displayHeight = Math.floor(canvas.clientHeight * dpr);

                if (canvas.width !== displayWidth || canvas.height !== displayHeight) {
                    canvas.width = displayWidth;
                    canvas.height = displayHeight;
                    gl.viewport(0, 0, canvas.width, canvas.height);
                }

                // Update uniforms
                const currentTime = (Date.now() - startTime) * 0.001;
                gl.uniform1f(uniformLocations.time, currentTime);
                gl.uniform2f(uniformLocations.resolution, canvas.width, canvas.height);
                
                // Set the fixed uniforms
                gl.uniform1f(uniformLocations.zoom, 0.1);
                gl.uniform1f(uniformLocations.exposure, 20000.0);

                for (const key in uniforms) {
                    if (!key.startsWith('color_mult_') && uniformLocations[key]) {
                        gl.uniform1f(uniformLocations[key], uniforms[key].value);
                    }
                }
                gl.uniform4f(uniformLocations.color_mult, 
                    uniforms.color_mult_r.value, 
                    uniforms.color_mult_g.value,
                    uniforms.color_mult_b.value,
                    uniforms.color_mult_a.value
                );

                // Draw
                gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);

                requestAnimationFrame(render);
            }

            requestAnimationFrame(render);
        };
    </script>
</body>
</html>
